<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="generator" content="Asciidoctor 0.1.4">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fuchsia</title>
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }
audio, canvas, video { display: inline-block; }
audio:not([controls]) { display: none; height: 0; }
[hidden] { display: none; }
html { background: #fff; color: #000; font-family: sans-serif; -ms-text-size-adjust: 100%; -webkit-text-size-adjust: 100%; }
body { margin: 0; }
a:focus { outline: thin dotted; }
a:active, a:hover { outline: 0; }
h1 { font-size: 2em; margin: 0.67em 0; }
abbr[title] { border-bottom: 1px dotted; }
b, strong { font-weight: bold; }
dfn { font-style: italic; }
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }
mark { background: #ff0; color: #000; }
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }
pre { white-space: pre-wrap; }
q { quotes: "\201C" "\201D" "\2018" "\2019"; }
small { font-size: 80%; }
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }
sup { top: -0.5em; }
sub { bottom: -0.25em; }
img { border: 0; }
svg:not(:root) { overflow: hidden; }
figure { margin: 0; }
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }
legend { border: 0; padding: 0; }
button, input, select, textarea { font-family: inherit; font-size: 100%; margin: 0; }
button, input { line-height: normal; }
button, select { text-transform: none; }
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; cursor: pointer; }
button[disabled], html input[disabled] { cursor: default; }
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; padding: 0; }
input[type="search"] { -webkit-appearance: textfield; -moz-box-sizing: content-box; -webkit-box-sizing: content-box; box-sizing: content-box; }
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }
textarea { overflow: auto; vertical-align: top; }
table { border-collapse: collapse; border-spacing: 0; }
*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }
html, body { font-size: 100%; }
body { background: white; color: #222222; padding: 0; margin: 0; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }
a:hover { cursor: pointer; }
a:focus { outline: none; }
img, object, embed { max-width: 100%; height: auto; }
object, embed { height: 100%; }
img { -ms-interpolation-mode: bicubic; }
#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }
.left { float: left !important; }
.right { float: right !important; }
.text-left { text-align: left !important; }
.text-right { text-align: right !important; }
.text-center { text-align: center !important; }
.text-justify { text-align: justify !important; }
.hide { display: none; }
.antialiased, body { -webkit-font-smoothing: antialiased; }
img { display: inline-block; vertical-align: middle; }
textarea { height: auto; min-height: 50px; }
select { width: 100%; }
p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1.21875em; line-height: 1.6; }
.subheader, #content #toctitle, .admonitionblock td.content > .title, .exampleblock > .title, .imageblock > .title, .videoblock > .title, .listingblock > .title, .literalblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, .sidebarblock > .title, .tableblock > .title, .verseblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title, .tableblock > caption { line-height: 1.4; color: #7a2518; font-weight: 300; margin-top: 0.2em; margin-bottom: 0.5em; }
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }
a { color: #005498; text-decoration: underline; line-height: inherit; }
a:hover, a:focus { color: #00467f; }
a img { border: none; }
p { font-family: inherit; font-weight: normal; font-size: 1em; line-height: 1.6; margin-bottom: 1.25em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: Georgia, "URW Bookman L", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; color: #ba3925; text-rendering: optimizeLegibility; margin-top: 1em; margin-bottom: 0.5em; line-height: 1.2125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #e99b8f; line-height: 0; }
h1 { font-size: 2.125em; }
h2 { font-size: 1.6875em; }
h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }
h4 { font-size: 1.125em; }
h5 { font-size: 1.125em; }
h6 { font-size: 1em; }
hr { border: solid #dddddd; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }
em, i { font-style: italic; line-height: inherit; }
strong, b { font-weight: bold; line-height: inherit; }
small { font-size: 60%; line-height: inherit; }
code { font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: normal; color: #6d180b; }
ul, ol, dl { font-size: 1em; line-height: 1.6; margin-bottom: 1.25em; list-style-position: outside; font-family: inherit; }
ul, ol { margin-left: 1.5em; }
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }
dl dt { margin-bottom: 0.3125em; font-weight: bold; }
dl dd { margin-bottom: 1.25em; }
abbr, acronym { text-transform: uppercase; font-size: 90%; color: #222222; border-bottom: 1px dotted #dddddd; cursor: help; }
abbr { text-transform: none; }
blockquote { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
blockquote cite { display: block; font-size: inherit; color: #555555; }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: #555555; }
blockquote, blockquote p { line-height: 1.6; color: #6f6f6f; }
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #dddddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }
.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }
@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; }
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
  h4 { font-size: 1.4375em; } }
.print-only { display: none !important; }
@media print { * { background: transparent !important; color: #000 !important; box-shadow: none !important; text-shadow: none !important; }
  a, a:visited { text-decoration: underline; }
  a[href]:after { content: " (" attr(href) ")"; }
  abbr[title]:after { content: " (" attr(title) ")"; }
  .ir a:after, a[href^="javascript:"]:after, a[href^="#"]:after { content: ""; }
  pre, blockquote { border: 1px solid #999; page-break-inside: avoid; }
  thead { display: table-header-group; }
  tr, img { page-break-inside: avoid; }
  img { max-width: 100% !important; }
  @page { margin: 0.5cm; }
  p, h2, h3, #toctitle, .sidebarblock > .content > .title { orphans: 3; widows: 3; }
  h2, h3, #toctitle, .sidebarblock > .content > .title { page-break-after: avoid; }
  .hide-on-print { display: none !important; }
  .print-only { display: block !important; }
  .hide-for-print { display: none !important; }
  .show-for-print { display: inherit !important; } }
table { background: white; margin-bottom: 1.25em; border: solid 1px #dddddd; }
table thead, table tfoot { background: whitesmoke; font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 0.5em 0.625em 0.625em; font-size: inherit; color: #222222; text-align: left; }
table tr th, table tr td { padding: 0.5625em 0.625em; font-size: inherit; color: #222222; }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: #f9f9f9; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.6; }
.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }
*:not(pre) > code { font-size: 0.9375em; padding: 1px 3px 0; white-space: nowrap; background-color: #f2f2f2; border: 1px solid #cccccc; -webkit-border-radius: 4px; border-radius: 4px; text-shadow: none; }
pre, pre > code { line-height: 1.4; color: inherit; font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: normal; }
kbd.keyseq { color: #555555; }
kbd:not(.keyseq) { display: inline-block; color: #222222; font-size: 0.75em; line-height: 1.4; background-color: #F7F7F7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px white inset; margin: -0.15em 0.15em 0 0.15em; padding: 0.2em 0.6em 0.2em 0.5em; vertical-align: middle; white-space: nowrap; }
kbd kbd:first-child { margin-left: 0; }
kbd kbd:last-child { margin-right: 0; }
.menuseq, .menu { color: #090909; }
p a > code:hover { color: #561309; }
#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 0.9375em; padding-right: 0.9375em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }
#header { margin-bottom: 2.5em; }
#header > h1 { color: black; font-weight: normal; border-bottom: 1px solid #dddddd; margin-bottom: -28px; padding-bottom: 32px; }
#header span { color: #6f6f6f; }
#header #revnumber { text-transform: capitalize; }
#header br { display: none; }
#header br + span { padding-left: 3px; }
#header br + span:before { content: "\2013 \0020"; }
#header br + span.author { padding-left: 0; }
#header br + span.author:before { content: ", "; }
#toc { border-bottom: 3px double #ebebeb; padding-bottom: 1.25em; }
#toc > ul { margin-left: 0.25em; }
#toc ul.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1 { margin-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
#toc ul { list-style-type: none; }
#toctitle { color: #7a2518; }
@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; }
  #toc.toc2 { position: fixed; width: 20em; left: 0; top: 0; border-right: 1px solid #ebebeb; border-bottom: 0; z-index: 1000; padding: 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; }
  #toc.toc2 > ul { font-size: .95em; }
  #toc.toc2 ul ul { margin-left: 0; padding-left: 1.25em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; }
  body.toc2.toc-right #toc.toc2 { border-right: 0; border-left: 1px solid #ebebeb; left: auto; right: 0; } }
#content #toc { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; border-width: 0; -webkit-border-radius: 4px; border-radius: 4px; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }
#content #toc a { text-decoration: none; }
#content #toctitle { font-weight: bold; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-size: 1em; padding-left: 0.125em; }
#footer { max-width: 100%; background-color: #222222; padding: 1.25em; }
#footer-text { color: #dddddd; line-height: 1.44; }
.sect1 { padding-bottom: 1.25em; }
.sect1 + .sect1 { border-top: 3px double #ebebeb; }
#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; width: 1em; margin-left: -1em; display: block; text-decoration: none; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: '\00A7'; font-size: .85em; vertical-align: text-top; display: block; margin-top: 0.05em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #ba3925; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #a53221; }
.imageblock, .literalblock, .listingblock, .verseblock, .videoblock { margin-bottom: 1.25em; }
.admonitionblock td.content > .title, .exampleblock > .title, .imageblock > .title, .videoblock > .title, .listingblock > .title, .literalblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, .sidebarblock > .title, .tableblock > .title, .verseblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-align: left; font-weight: bold; }
.tableblock > caption { text-align: left; font-weight: bold; white-space: nowrap; overflow: visible; max-width: 0; }
table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p { font-size: inherit; }
.admonitionblock > table { border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: none; }
.admonitionblock > table td.icon .title { font-weight: bold; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #dddddd; color: #6f6f6f; }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }
.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 4px; border-radius: 4px; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }
.exampleblock > .content h1, .exampleblock > .content h2, .exampleblock > .content h3, .exampleblock > .content #toctitle, .sidebarblock.exampleblock > .content > .title, .exampleblock > .content h4, .exampleblock > .content h5, .exampleblock > .content h6, .exampleblock > .content p { color: #333333; }
.exampleblock > .content h1, .exampleblock > .content h2, .exampleblock > .content h3, .exampleblock > .content #toctitle, .sidebarblock.exampleblock > .content > .title, .exampleblock > .content h4, .exampleblock > .content h5, .exampleblock > .content h6 { line-height: 1; margin-bottom: 0.625em; }
.exampleblock > .content h1.subheader, .exampleblock > .content h2.subheader, .exampleblock > .content h3.subheader, .exampleblock > .content .subheader#toctitle, .sidebarblock.exampleblock > .content > .subheader.title, .exampleblock > .content h4.subheader, .exampleblock > .content h5.subheader, .exampleblock > .content h6.subheader { line-height: 1.4; }
.exampleblock.result > .content { -webkit-box-shadow: 0 1px 8px #d9d9d9; box-shadow: 0 1px 8px #d9d9d9; }
.sidebarblock { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; -webkit-border-radius: 4px; border-radius: 4px; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock h1, .sidebarblock h2, .sidebarblock h3, .sidebarblock #toctitle, .sidebarblock > .content > .title, .sidebarblock h4, .sidebarblock h5, .sidebarblock h6, .sidebarblock p { color: #333333; }
.sidebarblock h1, .sidebarblock h2, .sidebarblock h3, .sidebarblock #toctitle, .sidebarblock > .content > .title, .sidebarblock h4, .sidebarblock h5, .sidebarblock h6 { line-height: 1; margin-bottom: 0.625em; }
.sidebarblock h1.subheader, .sidebarblock h2.subheader, .sidebarblock h3.subheader, .sidebarblock .subheader#toctitle, .sidebarblock > .content > .subheader.title, .sidebarblock h4.subheader, .sidebarblock h5.subheader, .sidebarblock h6.subheader { line-height: 1.4; }
.sidebarblock > .content > .title { color: #7a2518; margin-top: 0; line-height: 1.6; }
.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }
.literalblock > .content pre, .listingblock > .content pre { background: none; border-width: 1px 0; border-style: dotted; border-color: #bfbfbf; -webkit-border-radius: 4px; border-radius: 4px; padding: 0.75em 0.75em 0.5em 0.75em; word-wrap: break-word; }
.literalblock > .content pre.nowrap, .listingblock > .content pre.nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
.literalblock > .content pre > code, .listingblock > .content pre > code { display: block; }
@media only screen { .literalblock > .content pre, .listingblock > .content pre { font-size: 0.8em; } }
@media only screen and (min-width: 768px) { .literalblock > .content pre, .listingblock > .content pre { font-size: 0.9em; } }
@media only screen and (min-width: 1280px) { .literalblock > .content pre, .listingblock > .content pre { font-size: 1em; } }
.listingblock > .content { position: relative; }
.listingblock:hover code[class*=" language-"]:before { text-transform: uppercase; font-size: 0.9em; color: #999; position: absolute; top: 0.375em; right: 0.375em; }
.listingblock:hover code.asciidoc:before { content: "asciidoc"; }
.listingblock:hover code.clojure:before { content: "clojure"; }
.listingblock:hover code.css:before { content: "css"; }
.listingblock:hover code.groovy:before { content: "groovy"; }
.listingblock:hover code.html:before { content: "html"; }
.listingblock:hover code.java:before { content: "java"; }
.listingblock:hover code.javascript:before { content: "javascript"; }
.listingblock:hover code.python:before { content: "python"; }
.listingblock:hover code.ruby:before { content: "ruby"; }
.listingblock:hover code.scss:before { content: "scss"; }
.listingblock:hover code.xml:before { content: "xml"; }
.listingblock:hover code.yaml:before { content: "yaml"; }
.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: #999; }
.listingblock.terminal pre .command:not([data-prompt]):before { content: '$'; }
table.pyhltable { border: 0; margin-bottom: 0; }
table.pyhltable td { vertical-align: top; padding-top: 0; padding-bottom: 0; }
table.pyhltable td.code { padding-left: .75em; padding-right: 0; }
.highlight.pygments .lineno, table.pyhltable td:not(.code) { color: #999; padding-left: 0; padding-right: .5em; border-right: 1px solid #dddddd; }
.highlight.pygments .lineno { display: inline-block; margin-right: .25em; }
table.pyhltable .linenodiv { background-color: transparent !important; padding-right: 0 !important; }
.quoteblock { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
.quoteblock blockquote { margin: 0 0 1.25em 0; padding: 0 0 0.5625em 0; border: 0; }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: -.25em; padding-bottom: 0.5625em; font-size: inherit; color: #555555; }
.quoteblock .attribution br { display: none; }
.quoteblock .attribution cite { display: block; margin-bottom: 0.625em; }
table thead th, table tfoot th { font-weight: bold; }
table.tableblock.grid-all { border-collapse: separate; border-spacing: 1px; -webkit-border-radius: 4px; border-radius: 4px; border-top: 1px solid #dddddd; border-bottom: 1px solid #dddddd; }
table.tableblock.frame-topbot, table.tableblock.frame-none { border-left: 0; border-right: 0; }
table.tableblock.frame-sides, table.tableblock.frame-none { border-top: 0; border-bottom: 0; }
table.tableblock td .paragraph:last-child p, table.tableblock td > p:last-child { margin-bottom: 0; }
th.tableblock.halign-left, td.tableblock.halign-left { text-align: left; }
th.tableblock.halign-right, td.tableblock.halign-right { text-align: right; }
th.tableblock.halign-center, td.tableblock.halign-center { text-align: center; }
th.tableblock.valign-top, td.tableblock.valign-top { vertical-align: top; }
th.tableblock.valign-bottom, td.tableblock.valign-bottom { vertical-align: bottom; }
th.tableblock.valign-middle, td.tableblock.valign-middle { vertical-align: middle; }
p.tableblock.header { color: #222222; font-weight: bold; }
td > div.verse { white-space: pre; }
ol { margin-left: 1.75em; }
ul li ol { margin-left: 1.5em; }
dl dd { margin-left: 1.125em; }
dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }
ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: 0.625em; }
ul.unstyled, ol.unnumbered, ul.checklist, ul.none { list-style-type: none; }
ul.unstyled, ol.unnumbered, ul.checklist { margin-left: 0.625em; }
ul.checklist li > p:first-child > i[class^="icon-check"]:first-child, ul.checklist li > p:first-child > input[type="checkbox"]:first-child { margin-right: 0.25em; }
ul.checklist li > p:first-child > input[type="checkbox"]:first-child { position: relative; top: 1px; }
ul.inline { margin: 0 auto 0.625em auto; margin-left: -1.375em; margin-right: 0; padding: 0; list-style: none; overflow: hidden; }
ul.inline > li { list-style: none; float: left; margin-left: 1.375em; display: block; }
ul.inline > li > * { display: block; }
.unstyled dl dt { font-weight: normal; font-style: normal; }
ol.arabic { list-style-type: decimal; }
ol.decimal { list-style-type: decimal-leading-zero; }
ol.loweralpha { list-style-type: lower-alpha; }
ol.upperalpha { list-style-type: upper-alpha; }
ol.lowerroman { list-style-type: lower-roman; }
ol.upperroman { list-style-type: upper-roman; }
ol.lowergreek { list-style-type: lower-greek; }
.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }
td.hdlist1 { padding-right: .8em; font-weight: bold; }
td.hdlist1, td.hdlist2 { vertical-align: top; }
.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }
.colist > table tr > td:first-of-type { padding: 0 .8em; line-height: 1; }
.colist > table tr > td:last-of-type { padding: 0.25em 0; }
.qanda > ol > li > p > em:only-child { color: #00467f; }
.thumb, .th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: 0 0 0 1px #dddddd; box-shadow: 0 0 0 1px #dddddd; }
.imageblock.left, .imageblock[style*="float: left"] { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right, .imageblock[style*="float: right"] { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }
.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }
a.image { text-decoration: none; }
span.footnote, span.footnoteref { vertical-align: super; font-size: 0.875em; }
span.footnote a, span.footnoteref a { text-decoration: none; }
#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -.25em 0 .75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em; line-height: 1.3; font-size: 0.875em; margin-left: 1.2em; text-indent: -1.2em; margin-bottom: .2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }
#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }
.gist .file-data > table { border: none; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }
div.unbreakable { page-break-inside: avoid; }
.big { font-size: larger; }
.small { font-size: smaller; }
.underline { text-decoration: underline; }
.overline { text-decoration: overline; }
.line-through { text-decoration: line-through; }
.aqua { color: #00bfbf; }
.aqua-background { background-color: #00fafa; }
.black { color: black; }
.black-background { background-color: black; }
.blue { color: #0000bf; }
.blue-background { background-color: #0000fa; }
.fuchsia { color: #bf00bf; }
.fuchsia-background { background-color: #fa00fa; }
.gray { color: #606060; }
.gray-background { background-color: #7d7d7d; }
.green { color: #006000; }
.green-background { background-color: #007d00; }
.lime { color: #00bf00; }
.lime-background { background-color: #00fa00; }
.maroon { color: #600000; }
.maroon-background { background-color: #7d0000; }
.navy { color: #000060; }
.navy-background { background-color: #00007d; }
.olive { color: #606000; }
.olive-background { background-color: #7d7d00; }
.purple { color: #600060; }
.purple-background { background-color: #7d007d; }
.red { color: #bf0000; }
.red-background { background-color: #fa0000; }
.silver { color: #909090; }
.silver-background { background-color: #bcbcbc; }
.teal { color: #006060; }
.teal-background { background-color: #007d7d; }
.white { color: #bfbfbf; }
.white-background { background-color: #fafafa; }
.yellow { color: #bfbf00; }
.yellow-background { background-color: #fafa00; }
span.icon > [class^="icon-"], span.icon > [class*=" icon-"] { cursor: default; }
.admonitionblock td.icon [class^="icon-"]:before { font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #005498; color: #003f72; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }
.conum { display: inline-block; color: white !important; background-color: #222222; -webkit-border-radius: 100px; border-radius: 100px; text-align: center; width: 20px; height: 20px; font-size: 12px; font-weight: bold; line-height: 20px; font-family: Arial, sans-serif; font-style: normal; position: relative; top: -2px; letter-spacing: -1px; }
.conum * { color: white !important; }
.conum + b { display: none; }
.conum:after { content: attr(data-value); }
.conum:not([data-value]):empty { display: none; }
.literalblock > .content > pre, .listingblock > .content > pre { -webkit-border-radius: 0; border-radius: 0; }

</style>
<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/7.3/styles/default.min.css">
<script src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/7.3/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad()</script>
</head>
<body class="article toc2 toc-right">
<div id="header">
<h1>Fuchsia</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_what_can_fuchsia_do_for_me">What can Fuchsia do for me?</a></li>
<li><a href="#_what_is_fuchsia">What is Fuchsia?</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_declarations">Declarations</a></li>
<li><a href="#_discoveries">Discoveries</a></li>
<li><a href="#_processors">Processors</a></li>
<li><a href="#_linkers">Linkers</a></li>
</ul>
</li>
<li><a href="#_instalation">Instalation</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_using_as_maven_dependency">Using as maven dependency</a></li>
<li><a href="#_compiling_a_distribution">Compiling a distribution</a></li>
</ul>
</li>
<li><a href="#_input_output_of_processors">Input-Output of processors</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_fake_importer">Fake importer</a></li>
<li><a href="#_jax_ws_importer">JAX-WS importer</a></li>
<li><a href="#_mqtt_importer">MQTT importer</a></li>
<li><a href="#_pubsubhubbub_importer">PubSubHubBub importer</a></li>
</ul>
</li>
<li><a href="#_basic">Basic</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_creating_a_bundle">Creating a bundle</a></li>
<li><a href="#_import_a_jax_ws_service">Import a JAX-WS service</a></li>
<li><a href="#_import_a_push_service">Import a PuSH service</a></li>
<li><a href="#_import_a_mqtt_service">Import a MQTT service</a></li>
<li><a href="#_exporting_protobuffer_rpc_service">Exporting Protobuffer RPC service</a></li>
<li><a href="#_importing_protobuffer_rpc_service">Importing Protobuffer RPC service</a></li>
<li><a href="#_fake_discovery">Fake-Discovery</a></li>
<li><a href="#_fake_importer_2">Fake-Importer</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_what_can_fuchsia_do_for_me">What can Fuchsia do for me?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Fuchsia can materialize an OSGi outcast service (not visible in the platform) into the OSGi platform. Natively fuchsia can materialize:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>mDNS/DNSSD, bringing up the provider&#8217;s IP and the service type. This allows you to connect directly to the service without having to implement the discovery</p>
</li>
<li>
<p>UPnP services published on the network</p>
</li>
<li>
<p>JAX-WS endpoint, creating an instance of the service in OSGi platform (the interfaces must be available in the platform)</p>
</li>
<li>
<p>JSON-RPC endpoint, makes available into the platform a service for this remote instance, as expected it is mandatory to have the interfaces in order to create the OSGi instance of the endpoint</p>
</li>
<li>
<p>PuSH (PUbSubHubbub) hub, if you have a feed that uses PuSH as hub, all updates are sent via eventAdmin. Thus, avoiding you to implement the protocol</p>
</li>
<li>
<p>MQTT provider, so you can receive your MQTT messages locally (via EventAdmin) without having to implement the subscriber for this protocol</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All those are already builtin features, the materialization of an external service into OSGi platform, this processor is called: <strong>Importer</strong>.</p>
</div>
<div class="paragraph">
<p>The second type of processor is called <strong>Exporter</strong>, this type enables us to turn an OSGi service instance into a service that can be access outside of OSGi, exposed as a web service for instance. The builtin exporters are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>JAX-WS, based in an OSGi service instance, publishes a WebService to be accessed remotely. You can use Fuchsia to instantiate the exported service or use directly <a href="http://cxf.apache.org/">Apache CXF</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Of course those processors (<strong>importers</strong> or <strong>exporters</strong>) are available without needing to code a single line.</p>
</div>
<div class="paragraph">
<p>Albeit, Fuchsia has builtin processors, we are aware that most of applications use their own protocol or adopt their protocol specific device, knowing that Fuchsia was build to be extensible, thus implementing and deploying a customized processor is quite straight forward.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_what_is_fuchsia">What is Fuchsia?</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image"><a class="image" href="diagram/importer01.svg"><img src="diagram/importer01.svg" alt="Fuchsia" width="1024"></a></span></p>
</div>
<div class="paragraph">
<p>Fuchsia is an extensible tool for integrating external communication protocols inside an OSGi platform. It provides a common interface for creating and managing external connections.</p>
</div>
<div class="paragraph">
<p>As most of modern applications require multiple sources of information such as web services, databases or ubiquitous devices. The integration among those different services become a major issue when dealing with multitude of them.</p>
</div>
<div class="paragraph">
<p>In ubiquitous applications this kind of integration is even more important since the dynamicity and the multitude of protocol grows with number of devices supported.</p>
</div>
<div class="paragraph">
<p>So, developers are suddenly facing the challenge of mastering several protocol, and their respective tools for debugging, dependency managing, native calls access, access configuration, etc. That is where Fuchsia plays a key role, by providing the same way of dealing with different protocols, creating a single entrypoint for all protocols supported.</p>
</div>
<div class="paragraph">
<p>In Appsgate all those characteristics are gathered in order to provide an Smart Home environment.</p>
</div>
<div class="paragraph">
<p>You can administrate and monitor all the exchange of your OSGi platform with externals protocols through an unique control panel.</p>
</div>
<div class="ulist">
<div class="title">There exist essentially 4 types of entities inside fuchsia that you need to understand before go hands-on the code:</div>
<ul>
<li>
<p>Declaration, it is the metadata that describes a device or a service</p>
</li>
<li>
<p>Discovery, responsible for the detection of a device/service, in Fuchsia that means create a <strong>Declaration</strong> and adding it to the osgi registry</p>
</li>
<li>
<p>Processors, it represents the task itself.</p>
</li>
<li>
<p>Linkers, connects a declaration to a processor, evaluate the constraints to be respected in order to connect those two.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_declarations">Declarations</h3>
<div class="paragraph">
<p>Think in <strong>Declaration</strong> as a property file, although that it is not a file, it is an service registered in an OSGi platform, as long as this service is registered with the proper platform, <strong>Fuchsia</strong> will recognize it.</p>
</div>
<div class="paragraph">
<p>Its function is to indicate that a given device/service is available with certain properties, and is the role of an Importer/Exporter (explained later) to receive those information as inputs and create a bridge between the osgi platform and this device (all by using the properties given by the <strong>Declaration</strong>), allowing other services to access this device without knowing its protocol.</p>
</div>
</div>
<div class="sect2">
<h3 id="_discoveries">Discoveries</h3>
<div class="paragraph">
<p>As seen before, the way that we inform the Fuchsia platform the existence of a device/service is through a declaration <strong>Declaration</strong>, that can be registered manually of course (since its a service registered in OSGi platform with the interface <strong>org.ow2.chameleon.fuchsia.core.declaration.ImportDeclaration</strong>), but this can be done by fuchsia discoveries, that use specialized discovery protocols to extract all the relevant information of a given service/device and publish in OSGi platform a <strong>Declaration</strong> containing all those informations.</p>
</div>
<div class="ulist">
<div class="title">Available discovery implementations:</div>
<ul>
<li>
<p>Fake discovery</p>
</li>
<li>
<p>mDNS/DNSsd</p>
</li>
<li>
<p>uPnP</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_processors">Processors</h3>
<div class="sect3">
<h4 id="_importers">Importers</h4>
<div class="paragraph">
<p>In order to trigger <strong>importers</strong> to perform their job, they must to receive an <strong>import declaration</strong> which is configuration (think of it as a key value mapping, just like java properties). The <strong>importation declaration</strong> will recognized by <strong>Fuchsia</strong> as long as they are registered in OSGi with the proper Fuchsia interface (for an importer for example must be <strong>org.ow2.chameleon.fuchsia.core.declaration.ImportDeclaration</strong> )</p>
</div>
<div class="ulist">
<div class="title">Available implementations:</div>
<ul>
<li>
<p>Fake importer</p>
</li>
<li>
<p>JAX-RS</p>
</li>
<li>
<p>JAX-WS</p>
</li>
<li>
<p>JSON-RPC</p>
</li>
<li>
<p>MQTT</p>
</li>
<li>
<p>PUbSubHubBub</p>
</li>
<li>
<p>Protobuffer RPC</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_exporters">Exporters</h4>
<div class="paragraph">
<p>Analogue to the <strong>importers</strong>, the <strong>exporters</strong> must to receive a <strong>declaration</strong>, but in this case an <strong>export declaration</strong>. But its role is to provide an external access (by external meaning externally to the OSGi platform) to the services available in the current OSGi platform, for instance by publishing a WS.</p>
</div>
<div class="ulist">
<div class="title">Available implementations:</div>
<ul>
<li>
<p>JAX-WS</p>
</li>
<li>
<p>Protobuffer RPC</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_linkers">Linkers</h3>
<div class="paragraph">
<p>The existence of a <strong>declaration</strong> and a <strong>processor</strong> is not enough to trigger a connection between them, there has to exist a <strong>linker</strong>. This <em>linker</em> is resposible to check the condition on both sides (processor and declaration) see if they <em>match</em>, and just then establish a connection between them.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_instalation">Instalation</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_using_as_maven_dependency">Using as maven dependency</h3>
<div class="paragraph">
<p>Adopting Fuchsia is a straightforward task if you are used to Maven. First we need to add the OW2 maven repository to our list of repositories (as below).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="xml language-xml">&lt;project ... &gt;
...
&lt;repositories&gt;
	&lt;repository&gt;
		&lt;id&gt;ow2-release&lt;/id&gt;
		&lt;name&gt;OW2-Release&lt;/name&gt;
		&lt;url&gt;http://repository.ow2.org/nexus/content/groups/public/&lt;/url&gt;
	&lt;/repository&gt;
	&lt;repository&gt;
		&lt;id&gt;ow2-snapshot&lt;/id&gt;
		&lt;name&gt;OW2-Snapshot&lt;/name&gt;
		&lt;url&gt;http://repository.ow2.org/nexus/content/repositories/snapshots/&lt;/url&gt;
	&lt;/repository&gt;
&lt;/repositories&gt;
...
&lt;/project&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, we have to declare one or more Fuchsia module <strong>as a maven dependency</strong> of your project.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="xml language-xml">&lt;dependency&gt;
    &lt;groupId&gt;org.ow2.chameleon.fuchsia&lt;/groupId&gt;
    &lt;artifactId&gt;fuchsia-core&lt;/artifactId&gt;
    &lt;version&gt;0.0.1&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here we reference the version <strong>0.0.1</strong> of Fuchsia, but of course you can update that version for the version you are willing to use.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<img src="./images/icons/note.png" alt="Note">
</td>
<td class="content">
<div class="title">The catch</div>
<div class="paragraph">
<p>This method is quick and fast to integrate for compilation, although, depending on the importer adopted, it may require 3td party dependencies to be installed in your runtime platform manually. In order to not worry in finding all the dependencies for the importer adopted, you can use <strong>Fuchsia</strong> compilation profiles to gather all the dependencies needed according to your importers.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_compiling_a_distribution">Compiling a distribution</h3>
<div class="paragraph">
<p>In order to generate a Fuchsia distribution there is only one mandatory profile the <strong>core</strong>, all the other modules are optional and can be included in the distribution by adding the apropriate maven profile ( <strong>mvn -P parameter</strong> ). The maven profile and its contents are specified right below.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>core - This module contains all the basic Fuchsia types, fuchsia shell tool is installed automatically in this profile as well, even though its not part of the bundle core</p>
</li>
<li>
<p>discoveries</p>
<div class="ulist">
<ul>
<li>
<p><a href="http://jmdns.sourceforge.net/">mdns</a> - the implementation os dnssd/mdns discovery protocol</p>
</li>
<li>
<p>upnp</p>
</li>
</ul>
</div>
</li>
<li>
<p>importers</p>
<div class="ulist">
<ul>
<li>
<p>importer-cxf</p>
</li>
<li>
<p><a href="http://mqtt.org/">mqtt</a></p>
</li>
<li>
<p><a href="https://code.google.com/p/pubsubhubbub/">push</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>exporter</p>
<div class="ulist">
<ul>
<li>
<p>exporter-cxf</p>
</li>
</ul>
</div>
</li>
<li>
<p>tools</p>
<div class="ulist">
<ul>
<li>
<p>grid</p>
</li>
<li>
<p>fake</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_configuration_profiles">Configuration profiles</h4>
<div class="paragraph">
<p>Config profiles are the instantiation of the <em>linker</em> and the <em>processor</em>. Those two tend to be customized, since the filter adopted in the default instantiation of the linker might not be valid for for case</p>
</div>
<div class="ulist">
<ul>
<li>
<p>discoveries:</p>
<div class="ulist">
<ul>
<li>
<p>mdns-config</p>
</li>
</ul>
</div>
</li>
<li>
<p>importers:</p>
<div class="ulist">
<ul>
<li>
<p>importer-cxf-config</p>
</li>
<li>
<p>mqtt-config</p>
</li>
<li>
<p>push-config</p>
</li>
</ul>
</div>
</li>
<li>
<p>exporters:</p>
<div class="ulist">
<ul>
<li>
<p>exporter-cxf-config</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Thus, in order to compile Fuchsia with the <strong>grid</strong>, <strong>exporter-cxf</strong> and <strong>mqtt</strong>, would be enough to:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>go to the <strong>distribution</strong> directory</p>
</li>
<li>
<p>type <strong>mvn -Pcore,grid,exporter-cxf,mqtt</strong></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>After the compilation process is finished, your Fuchsia distribution is ready to use:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>go to the <strong>distribution/target/chameleon-distribution/</strong></p>
</li>
<li>
<p>type <strong>./chameleon.sh --interactive</strong> (or the apropriate script according to your OS)</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_input_output_of_processors">Input-Output of processors</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As seen in [Fuchsia 101](Fuchsia-101), importers use <strong>import declaration</strong> as input. The information contained in the <strong>import declaration</strong> must be enough in order that the processor execute its role properly.</p>
</div>
<div class="sect2">
<h3 id="_fake_importer">Fake importer</h3>
<div class="paragraph">
<p>As soon as this <strong>importer</strong> is connected to an <strong>import declaration</strong> it generates an instance of Fuchsia <strong>GenericDevice</strong>, and this instance is published as a service inside OSGi platform.</p>
</div>
</div>
<div class="sect2">
<h3 id="_jax_ws_importer">JAX-WS importer</h3>
<div class="ulist">
<div class="title">External Requirement:</div>
<ul>
<li>
<p>JAX-WS service published</p>
</li>
<li>
<p>Interface(a') that represents the WSDL available in the OSGi platform that will import the service</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Import Declaration information required:</div>
<ul>
<li>
<p>jax-ws.importer.interfaces</p>
</li>
<li>
<p>className</p>
</li>
<li>
<p>endpoint.url</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Output:</div>
<ul>
<li>
<p>OSGi service registered with a' representing the JAX-WS (Remote service)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Detailed Description</strong></p>
</div>
<div class="paragraph">
<p>Today to import the JAX-WS service Fushsia uses <a href="http://cxf.apache.org/">CXF</a>. CXF is used in order to reduce the complexity in creating the connection and handling with different issues that may be raised.</p>
</div>
</div>
<div class="sect2">
<h3 id="_mqtt_importer">MQTT importer</h3>
<div class="ulist">
<div class="title">External Requirement:</div>
<ul>
<li>
<p>MQTT server with the address known</p>
</li>
<li>
<p>EventAdmin service configured in the machine that will import this service</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Import Declaration information required:</div>
<ul>
<li>
<p>id</p>
</li>
<li>
<p>mqtt.queue</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Output:</div>
<ul>
<li>
<p>A message will be published in EventAdmin in the queue $mqtt.queue, meaning that it will use the same name of <strong>queue</strong> as MQTT</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Detailed Description</strong></p>
</div>
<div class="paragraph">
<p><a href="http://mqtt.org/">MQTT</a> is a protocol <a href="http://openiot.eu/">largely diffused</a> protocole for message exchange due to its good performance. The implementation used by Fuchsia to support MQTT was <a href="http://www.rabbitmq.com/">RabbitMQ</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_pubsubhubbub_importer">PubSubHubBub importer</h3>
<div class="paragraph">
<p><a href="http://code.google.com/p/pubsubhubbub/">PubSubHubBub</a>, or simply <strong>PuSH</strong>, is a publish/subscribe protocol created by google and used by some of its <a href="http://code.google.com/p/pubsubhubbub/wiki/HubbubAtGoogle">tools</a>.</p>
</div>
<div class="ulist">
<div class="title">External Requirement:</div>
<ul>
<li>
<p>PuSh server address</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Import Declaration information required:</div>
<ul>
<li>
<p>push.hub.url</p>
</li>
<li>
<p>push.hub.topic</p>
</li>
<li>
<p>push.subscriber.callback</p>
</li>
<li>
<p>push.eventAdmin.queue</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Output:</div>
<ul>
<li>
<p>A message will be published in EventAdmin in the queue $push.eventAdmin.queue, meaning that it will use the same name of <strong>queue</strong> as PuSH</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Detailed Description</strong></p>
</div>
<div class="paragraph">
<p>There are no well known and portable PuSH implementations, Fuchsia implemented partially <a href="https://pubsubhubbub.googlecode.com/git/pubsubhubbub-core-0.4.html">PuSH specification</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_basic">Basic</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_creating_a_bundle">Creating a bundle</h3>
<div class="paragraph">
<p>We can use maven plugin to create an iPOJO artifact.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">mvn org.apache.maven.plugins:maven-archetype-plugin:generate \
-DinteractiveMode=false \
-DarchetypeArtifactId=maven-ipojo-plugin \
-DarchetypeGroupId=org.apache.felix \
-DarchetypeVersion=1.11.0 \
-DartifactId=config \
-DgroupId=org.adele \
-Dpackage=org.adele \
-Dversion=0.0.1-EXAMPLE</code></pre>
</div>
</div>
<div class="paragraph">
<p>Make sure to add <strong>Fuchsia</strong> dependency:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="xml language-xml">&lt;dependency&gt;
    &lt;groupId&gt;org.ow2.chameleon.fuchsia&lt;/groupId&gt;
    &lt;artifactId&gt;fuchsia-core&lt;/artifactId&gt;
    &lt;version&gt;0.0.1&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>That is it, now you are ready to add your custom code.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<img src="./images/icons/warning.png" alt="Warning">
</td>
<td class="content">
<div class="paragraph">
<p>Make sure to replace the version <strong>0.0.1</strong> of Fuchsia, by the version that you are using</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_import_a_jax_ws_service">Import a JAX-WS service</h3>
<div class="paragraph">
<p>After create your project, we have couple tasks to accomplish before be able to use the imported JAX-WS service:</p>
</div>
<div class="ulist checklist">
<div class="title">Prepare the environment</div>
<ul class="checklist">
<li>
<p><input type="checkbox" data-item-complete="0" disabled> Instantiate the importer</p>
</li>
<li>
<p><input type="checkbox" data-item-complete="0" disabled> Instantiate the linker</p>
</li>
</ul>
</div>
<div class="ulist checklist">
<div class="title">As result of fuchsia</div>
<ul class="checklist">
<li>
<p><input type="checkbox" data-item-complete="0" disabled> Inform fuchsia the JAX-WS info</p>
</li>
<li>
<p><input type="checkbox" data-item-complete="0" disabled> Fetch your local instance</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_preparation">Preparation</h4>
<div class="paragraph">
<p>One step at a time, so lets first instantiate our importer, we first need to find out the name of our importer JAX-WS, which is <em>Fuchsia_importer.cxf</em>, with that in mind we can instantiate it indicating what are the <strong>Declarations</strong> that he should consider as a declaration that concerns it.</p>
</div>
<div class="paragraph">
<p>In our case we may say that, any declaration containing a value for the key <strong>endpoint.url</strong>, is a valid declaration to be processed by this importer, thus this give us:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>    Instance cxfimporter = Instance.instance()
            .of("Fuchsia_importer.cxf")
            .with("target").setto("(endpoint.url=*)");</code></pre>
</div>
</div>
<div class="paragraph">
<p>With this we can check our first task <strong>Instantiate the importer</strong>. Following our list we have instantiated the <strong>Linker</strong>.</p>
</div>
<div class="paragraph">
<p>The <strong>Linkers</strong> job is to evaluate if a given <strong>Declaration</strong> and a <strong>Service</strong> match together, so essentially he impose the condition in order to connect this two entities. We can instantiate our linker in following manner:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>    Instance cxfimporterlinker = instance()
            .of("FuchsiaDefaultImportationLinkerFactory")
            .with("fuchsia.linker.filter.importDeclaration").setto("(endpoint.url=*)")
            .with("fuchsia.linker.filter.importerService").setto("(instance.name=cxfimporterlinker)");</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this linker we are saying "if a declaration constains <em>endpoint.url</em> than connect it with the importer in which the instance is called <em>cxfimporterlinker</em>".</p>
</div>
<div class="paragraph">
<p>In order to <em>Inform fuchsia the JAX-WS info</em>, we have several options, either we can publish a service that follows the interface <em>org.ow2.chameleon.fuchsia.core.declaration.ImportDeclaration</em>, or we can use the Fake-Discovery, which translate files deployed in the folder named <em>load</em> into a ImportDeclaration.</p>
</div>
<div class="paragraph">
<p>You can check that everything is up and running by typing <strong>importer</strong> on the console, you should see at least:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>Importer [cxfimporter] provided by bundle cxf-importer (46)
	*importer name = cxfimporter
	Service properties:
		factory.name = Fuchsia_importer.cxf
		instance.name = cxfimporter
		objectClass = [Ljava.lang.String;@191c428
		service.id = 335
		target = (endpoint.url=*)</code></pre>
</div>
</div>
<div class="paragraph">
<p>And check that the FakeDiscovery is running as well by typing <strong>discovery</strong> and you will see:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>Discovery [Fuchsia-FakeDiscovery] provided by bundle fuchsia-fake-discovery (37)
	Service properties:
		factory.name = Fuchsia-FakeDiscovery-Factory
		fuchsia.system.fake.discovery.directory = load
		fuchsia.system.fake.discovery.polling = 2000
		instance.name = Fuchsia-FakeDiscovery
		objectClass = [Ljava.lang.String;@20e9c6
		service.id = 321
</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_result">Result</h4>
<div class="paragraph">
<p>So far we&#8217;ve our checklist look like this:</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<p><input type="checkbox" data-item-complete="1" checked disabled> Instantiate the importer</p>
</li>
<li>
<p><input type="checkbox" data-item-complete="1" checked disabled> Instantiate the linker</p>
</li>
<li>
<p><input type="checkbox" data-item-complete="0" disabled> Inform fuchsia the JAX-WS info</p>
</li>
<li>
<p><input type="checkbox" data-item-complete="0" disabled> Use the remote instance</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The last two steps consist in informing the Fuchsia the address of our JAX-WS service. For that its enough to deploy a file in the folder <em>load</em> (thanks to the Fake-Discovery) with the following content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>id=virtual-camera
className=org.ow2.chameleon.fuchsia.exporter.cxf.examples.base.PojoSampleToBeExportedIface
jax-ws.importer.interfaces=[org.ow2.chameleon.fuchsia.exporter.cxf.examples.base.PojoSampleToBeExportedIface]
endpoint.url=http://localhost:8080/cxf/service/PojoSampleToBeExportedIface

deviceType=camera
deviceSubType=another
device.serialNumber=virtual-camera</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, just request your service as a regular dependency (as shown below), then you ll see your dependency being injected and ready for use without much trouble.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">@Component
@Instantiate
public class Client {

    @Requires
    PojoSampleToBeExportedIface myRemoteService;

    @Validate
    public void validate(){

        System.out.println("----&gt;"+myRemoteService.getMessage2());

    }

}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_import_a_push_service">Import a PuSH service</h3>
<div class="paragraph">
<p>PubSubHubbub (PuSH) is a google protocol create to be fast, in fact it is a publish / subscribe mechanism that avoids the polling technique. A small diagram can show you the idea behind the protocol</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="diagram/push01.svg" alt="PuSH" width="800"></span></p>
</div>
<div class="sect3">
<h4 id="_prepare">Prepare</h4>
<div class="paragraph">
<p>So we are going to need, we are assuming that the publisher and hub addresses are well known.</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<p><input type="checkbox" data-item-complete="1" checked disabled> know the address of the publisher</p>
</li>
<li>
<p><input type="checkbox" data-item-complete="1" checked disabled> know the address of the hub</p>
</li>
<li>
<p><input type="checkbox" data-item-complete="0" disabled> Instantiate the Importer</p>
</li>
<li>
<p><input type="checkbox" data-item-complete="0" disabled> Instantiate the linker</p>
</li>
<li>
<p><input type="checkbox" data-item-complete="0" disabled> Inform fuchsia the Hub and Publisher addresses</p>
</li>
<li>
<p><input type="checkbox" data-item-complete="0" disabled> Visualize the messages</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The first two steps you have to know already those addresses, the next two steps can be done by using maven profile. Meaning that we can generate a chameleon distribution with all our fuchsia dependencies, linker and importer instantiated just by typing into the project repository:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">mvn clean install -f distribution/pom.xml -Pcore,push,push-config,fake &amp;&amp; \
cd distribution/target/chameleon-distribution/ &amp;&amp; \
sh chameleon.sh --interactive</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now lets verify our checklist:</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<p><input type="checkbox" data-item-complete="1" checked disabled> know the address of the publisher</p>
</li>
<li>
<p><input type="checkbox" data-item-complete="1" checked disabled> know the address of the hub</p>
</li>
<li>
<p><input type="checkbox" data-item-complete="1" checked disabled> Instantiate the Importer</p>
</li>
<li>
<p><input type="checkbox" data-item-complete="1" checked disabled> Instantiate the linker</p>
</li>
<li>
<p><input type="checkbox" data-item-complete="1" checked disabled> Inform fuchsia the Hub and Publisher addresses</p>
</li>
<li>
<p><input type="checkbox" data-item-complete="0" disabled> Visualize the messages</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The next step is done by add a file with all the information we already have about the PuSH server (example of the file below)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">id=push-dispatch-event-admin
deviceType=camera
deviceSubType=another

push.hub.topic=http://blogname.blogspot.com/feeds/posts/default
push.hub.url=http://localhost:8080/hub/subscribe
push.subscriber.callback=http://localhost:8080/push
push.eventAdmin.queue=public

device.serialNumber=push-dispatch-event-admin</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<img src="./images/icons/warning.png" alt="Warning">
</td>
<td class="content">
<div class="paragraph">
<p>The client must be accessible from the hub, since the hub is the one that pushes the change into clients callback</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>So we are able to see the redirection (from PuSH into Event admin) we install <a href="http://www.interior-dsgn.com/apache//felix/org.apache.felix.webconsole.plugins.event-1.1.0.jar">Web Console Event Admin Plugin</a>.</p>
</div>
<div class="paragraph">
<p>By default fuchsia distribution will install the <em>felix webconsole</em>, that can be access in the URL <a href="http://localhost:8080/system/console/events">http://localhost:8080/system/console/events</a>.</p>
</div>
<div class="paragraph">
<p>Now when you receive an update from the <em>Hub</em> it will be automatically redirected to eventAdmin message bus.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_import_a_mqtt_service">Import a MQTT service</h3>
<div class="paragraph">
<p>As MQTT is an efficient message exchange protocole, Fuchsia has builtin a <strong>MQTT</strong> importer that receives and forward messages from MQTT bus into EventAdmin bus.</p>
</div>
<div class="paragraph">
<p>The address of the MQTT server is supposely known, and the next two steps (importer and linker instantiation) can be done with the maven profile, according to the command below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">mvn clean install -f distribution/pom.xml -Pcore,mqtt,mqtt-config,fake &amp;&amp; \
cd distribution/target/chameleon-distribution/ &amp;&amp; \
sh chameleon.sh --interactive</code></pre>
</div>
</div>
<div class="paragraph">
<p>So lets verify how are we in relation to our checklist:</p>
</div>
<div class="paragraph">
<p>Lets create our checklist:</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<p><input type="checkbox" data-item-complete="1" checked disabled> know the address of the MQTT server</p>
</li>
<li>
<p><input type="checkbox" data-item-complete="1" checked disabled> Instantiate the Importer</p>
</li>
<li>
<p><input type="checkbox" data-item-complete="1" checked disabled> Instantiate the linker</p>
</li>
<li>
<p><input type="checkbox" data-item-complete="0" disabled> Inform fuchsia about the MQTT server address</p>
</li>
<li>
<p><input type="checkbox" data-item-complete="0" disabled> Visualize the messages</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We tell Fuchsia which MQTT server (and other parameters) by deploying a file into the <em>load</em> directory containing those info (with the content below):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">id=mqtt-dispatch-event-admin
deviceType=camera
deviceSubType=another

mqtt.queue=public
mqtt.server.host=localhost
mqtt.server.port=5672</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use <a href="http://localhost:8080/system/console/event">WebConsole</a> to see all the messages that come from MQTT and redirected to <strong>EventAdmin</strong>. The information <strong>mqtt.server.host</strong> and <strong>mqtt.server.port</strong> are optional, in case those informations are not available it will use the information defined as default by <strong>RabbitMQ</strong>.</p>
</div>
<div class="paragraph">
<p>So, after installing your MQTT server (in our case RabbitMQ) make sure its running</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">sudo /etc/init.d/rabbitmq-server status</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_exporting_protobuffer_rpc_service">Exporting Protobuffer RPC service</h3>
<div class="paragraph">
<p>In order to be able to export your <a href="https://code.google.com/p/protobuf/">Protobuffer</a> Service, feel things need to be done:</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<p><input type="checkbox" data-item-complete="0" disabled> Protobuffer class generated (Step 1)</p>
</li>
<li>
<p><input type="checkbox" data-item-complete="0" disabled> Implement the service methods for the Protobuffer generated class (Step 2)</p>
</li>
<li>
<p><input type="checkbox" data-item-complete="0" disabled> Protobuffer class instante added to OSGi Registry (Step 3)</p>
</li>
<li>
<p><input type="checkbox" data-item-complete="0" disabled> Instantiate the exporter and the linker (Step 4)</p>
</li>
<li>
<p><input type="checkbox" data-item-complete="0" disabled> Declare the exportation (Step 5)</p>
</li>
<li>
<p><input type="checkbox" data-item-complete="0" disabled> Create the runtime platform (Step 6)</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<img src="./images/icons/warning.png" alt="Warning">
</td>
<td class="content">
<div class="paragraph">
<p>Protobuffer <strong>version 2.5.0</strong> must be used, any version other than that may produce errors in the remote call</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_step_1">Step 1</h4>
<div class="paragraph">
<p>Follow the instalation procedure in <a href="https://code.google.com/p/protobuf/">Protobuffer</a> website to get the command for compile <em>.proto</em> file.</p>
</div>
<div class="paragraph">
<p>Here it is an example of a proto file that can be used for a first glance at the functionality.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">
package tutorial;

option java_package = "com.google.code.cxf.protobuf.addressbook";
option java_outer_classname = "AddressBookProtos";

message Person {
  required string name = 1;
  required int32 id = 2;        // Unique ID number for this person.
  optional string email = 3;

  enum PhoneType {
    MOBILE = 0;
    HOME = 1;
    WORK = 2;
  }

  message PhoneNumber {
    required string number = 1;
    optional PhoneType type = 2 [default = HOME];
  }

  repeated PhoneNumber phone = 4;
}

message AddressBook {
  repeated Person person = 1;
}

service AddressBookService {
  rpc addPerson(Person) returns(AddressBookSize);
  rpc listPeople(NamePattern) returns(AddressBook);
}

message AddressBookServiceMessage {
  optional Person addPerson = 1;
  optional NamePattern listPeople = 2;
}

message AddressBookSize {
  optional int32 size = 1;
}

message NamePattern {
  optional string pattern = 1;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>From this file you can generate your classe by invoking</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="bash language-bash">protoc --java_out=src/main/java/ addressbook.proto</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_step_2">Step 2</h4>
<div class="paragraph">
<p>When <em>rpc service</em> is declared in the <em>proto</em> file, this will generate an interface that <strong>must</strong> to be implemented in order that this rpc service can be called. Since the <em>proto</em> file is not a language, we cannot define what the method should to at this point, it is pretty logic, right?</p>
</div>
<div class="paragraph">
<p>So in our case we should implement two methods <strong>addPerson</strong> and <strong>listPeople</strong>, the exactly two services declared in the <em>proto</em> file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">public class AddressBookServiceImpl extends AddressBookProtos.AddressBookService {
    Map&lt;Integer, AddressBookProtos.Person&gt; records = new ConcurrentHashMap&lt;Integer, AddressBookProtos.Person&gt;();

    public void listPeople(RpcController controller,
                           AddressBookProtos.NamePattern request, RpcCallback&lt;AddressBookProtos.AddressBook&gt; done) {
	...
    }

    public void addPerson(RpcController controller,
                          AddressBookProtos.Person request, RpcCallback&lt;AddressBookProtos.AddressBookSize&gt; done) {
        ...
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>An example of body for these two methods can be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">public class AddressBookServiceImpl extends AddressBookProtos.AddressBookService {
    Map&lt;Integer, AddressBookProtos.Person&gt; records = new ConcurrentHashMap&lt;Integer, AddressBookProtos.Person&gt;();

    public void listPeople(RpcController controller,
                           AddressBookProtos.NamePattern request, RpcCallback&lt;AddressBookProtos.AddressBook&gt; done) {
        AddressBookProtos.AddressBook.Builder addressbook = AddressBookProtos.AddressBook
                .newBuilder();

        for (AddressBookProtos.Person person : records.values()) {
            if (person.getName().indexOf(request.getPattern()) &gt;= 0) {
                addressbook.addPerson(person);
            }
        }

        done.run(addressbook.build());
    }

    public void addPerson(RpcController controller,
                          AddressBookProtos.Person request, RpcCallback&lt;AddressBookProtos.AddressBookSize&gt; done) {
        if (records.containsKey(request.getId())) {
            System.out.println("Warning: will replace existing person: " + records.get(request.getId()).getName());
        }
        records.put(request.getId(), request);
        done.run(AddressBookProtos.AddressBookSize.newBuilder().setSize(
                records.size()).build());
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, its not something straight forward as you thought it should be.</p>
</div>
</div>
<div class="sect3">
<h4 id="_step_3">Step 3</h4>
<div class="paragraph">
<p>In this step, we instantiate our service (in java level) and publish it in the OSGi registry. There are several ways of doing this <strong>Step</strong> so pick up your flavor. We ll do like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">@Component
@Instantiate
public class RegisterBookService {

    ...

    @Validate
    public void validate(){

        Dictionary serviceProperties=new Hashtable&lt;String,Object&gt;();

        context.registerService(
		new String[]{com.google.protobuf.Service.class.getName(),AddressBookProtos.AddressBookService.class.getName()},
		new AddressBookServiceImpl(),
		serviceProperties);

    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This procedure will allow the fuchsia exporter to fetch this instance and export it.</p>
</div>
</div>
<div class="sect3">
<h4 id="_step_4">Step 4</h4>
<div class="paragraph">
<p>As you should have seen in previous sections, the <strong>exporter</strong> (for our case) and a <strong>linker</strong> must be instantiated, they are not instantiated automatically.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">@Configuration
public class Config {
    Instance ProtobufferExporter = instance()
            .of("ProtobufferExporterFactory")
            .with("target").setto("(rpc.export.address=*)");

    Instance ProtobufferExporterLinker = instance()
            .of(FuchsiaConstants.DEFAULT_EXPORTATION_LINKER_FACTORY_NAME)
            .with(ExportationLinker.FILTER_EXPORTDECLARATION_PROPERTY).setto("(rpc.export.address=*)")
            .with(ExportationLinker.FILTER_EXPORTERSERVICE_PROPERTY).setto("(instance.name=ProtobufferExporter)");
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>See that the filters can be customized, they defined the <strong>export declaration</strong> that should be catch by this exporter.</p>
</div>
</div>
<div class="sect3">
<h4 id="_step_5">Step 5</h4>
<div class="paragraph">
<p>The <strong>export declaration</strong> is the intention, in fact it is this file that you express to the framework "Look, i have X instance, and i would like to expose (export) that instance as a Protobuffer RPC service".</p>
</div>
<div class="paragraph">
<p>This sentenced is converted in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">@Component
@Instantiate
public class ExportDeclaration {

    ...

    @Validate
    public void validate(){

        Map&lt;String, Object&gt; metadata=new HashMap&lt;String, Object&gt;();

        metadata.put("id","export-tests");
        metadata.put("exporter.id","myservice");
        metadata.put("rpc.export.address","http://localhost:8889/AddressBookService");
        metadata.put("rpc.export.class","org.ow2.chameleon.fuchsia.protobuffer.protoclass.AddressBookProtos$AddressBookService");
        metadata.put("rpc.export.message","org.ow2.chameleon.fuchsia.protobuffer.protoclass.AddressBookProtos$AddressBookServiceMessage");

        org.ow2.chameleon.fuchsia.core.declaration.ExportDeclaration declaration = ExportDeclarationBuilder.fromMetadata(metadata).build();

        Dictionary&lt;String, Object&gt; props = new Hashtable&lt;String, Object&gt;();

        String clazzes[] = new String[]{org.ow2.chameleon.fuchsia.core.declaration.ExportDeclaration.class.getName()};
        ServiceRegistration registration = context.registerService(clazzes, declaration, props);

    }

}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_step_6">Step 6</h4>
<div class="paragraph">
<p>Assuming that you have compiled fuchsia (in previous sections), you can use <strong>distribution</strong> module to generate a distribution with dependencies needed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">mvn clean install -Pcore,fake,protobuffer &amp;&amp; cd target/chameleon-distribution &amp;&amp; \
sh chameleon.sh --interactive</code></pre>
</div>
</div>
<div class="paragraph">
<p>To verify that everything was published properly, it is enough to access the url <a href="http://localhost:8889/AddressBookService?proto">http://localhost:8889/AddressBookService?proto</a> (pay attention that the base url is the same URL we declared in out metadata file)</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_importing_protobuffer_rpc_service">Importing Protobuffer RPC service</h3>
<div class="paragraph">
<p>Here, we can see the similatity in the importation process, if a given protocol is supported by Fuchsia the processors are used similarly independently of the protocol.</p>
</div>
<div class="ulist checklist">
<div class="title">Prepare the environment</div>
<ul class="checklist">
<li>
<p><input type="checkbox" data-item-complete="0" disabled> Instantiate the importer &amp; linker (Step 1)</p>
</li>
<li>
<p><input type="checkbox" data-item-complete="0" disabled> Publish your intention, in fuchsia the <strong>declaration</strong> (Step 2)</p>
</li>
<li>
<p><input type="checkbox" data-item-complete="0" disabled> Fetch your local instance (Step 3)</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_step_1_2">Step 1</h4>
<div class="paragraph">
<p>This step is mandatory for use of <strong>processors</strong> (importer, exporter). From the moment you instantiate one processor, it is usually required for you to create a <strong>linker</strong> otherwise your service cannot be notified in case of a <strong>declaration</strong> appeareance.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">@Configuration
public class ProtobufferImporterConfig {
	    Instance ProtobufferRPCImporter = instance()
		    .of("ProtobufferImporterFactory")
		    .with("target").setto("(&amp;(rpc.server.address=*)(rpc.proto.class=*)(rpc.proto.service=*)(rpc.proto.message=*))");

	    Instance ProtobufferRPCLinker = instance()
		    .of(FuchsiaConstants.DEFAULT_IMPORTATION_LINKER_FACTORY_NAME)
		    .with(ImportationLinker.FILTER_IMPORTDECLARATION_PROPERTY).setto("(&amp;(rpc.server.address=*)(rpc.proto.class=*)(rpc.proto.service=*)(rpc.proto.message=*))")
		    .with(ImportationLinker.FILTER_IMPORTERSERVICE_PROPERTY).setto("(instance.name=ProtobufferRPCImporter)");
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_step_2_2">Step 2</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">id=cxf-protobuffer-importer

deviceType=camera
deviceSubType=another
device.serialNumber=virtual-camera

rpc.server.address=http://localhost:8889/AddressBookService
rpc.proto.class=org.ow2.chameleon.fuchsia.protobuffer.protoclass.AddressBookProtos
rpc.proto.service=AddressBookService
rpc.proto.message=AddressBookServiceMessage</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_step_3_2">Step 3</h4>
<div class="paragraph">
<p>Now, you are ready to go, the only thing you have to do now is to annotate your dependency as usual, and enjoy it.</p>
</div>
<div class="paragraph">
<p>As always here is it the example we put to work:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">@Component
@Instantiate
public class BookClient {

    private BundleContext context;

    @Requires (filter = "(fuchsia.importer.id=cxf-protobuffer-importer)")
    AddressBookProtos.AddressBookService addressBook;

    public BookClient(BundleContext context){
        this.context=context;
    }


    @Validate
    public void validate(){

        SimpleRpcController controller = new SimpleRpcController();

        AddressBookProtos.Person.Builder person = AddressBookProtos.Person.newBuilder();

        person.setId(1);
        person.setName("Alice");
        AddressBookProtos.Person alice = person.build();

        addressBook.addPerson(controller, alice, new RpcCallback&lt;AddressBookProtos.AddressBookSize&gt;() {
            public void run(AddressBookProtos.AddressBookSize size) {
                System.out.println("\nThere are " + size.getSize()
                        + " person(s) in the address book now.");
            }
        });

        controller.reset();

        System.out.println("\nSearching for people with 'A' in their name.");
        addressBook.listPeople(controller, AddressBookProtos.NamePattern.newBuilder().setPattern("A")
                .build(), new RpcCallback&lt;AddressBookProtos.AddressBook&gt;() {
            public void run(AddressBookProtos.AddressBook response) {

                System.out.println("\nList of people found: \n");

                for (AddressBookProtos.Person person : response.getPersonList()) {

                    System.out.println("--&gt;" + person.getName());

                }


            }
        });

    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The only reason we added the filter in <strong>@Required</strong> was to make sure that the remote instance (created by imported) is injected. So this is not mandatory in regular cases.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_fake_discovery">Fake-Discovery</h3>
<div class="paragraph">
<p>First things first, in order to have an discovery we need to create a fuchsia distribution that embbeds it, or to use an already existing distribution and add the modules required. Below we ll show you how to use couples of discoveries that are available in the platform.</p>
</div>
<div class="sect3">
<h4 id="_what_it_does">What it does?!</h4>
<div class="paragraph">
<p>As seen in the introduction the fundamental task of a discovery is to create an instance of Declaration which represents the availability of a service/device, and the intrinsic information of such service/device are contained inside <strong>Declaration</strong> as properties (stored in a Map).</p>
</div>
<div class="paragraph">
<p>The idea behind having a fake discovery, is in infact be able to deploy a file (property file style, containing key value mapping).</p>
</div>
<div class="paragraph">
<p>In order to activate the fake discovery its enough to compile the distribution with the profile <strong>fake</strong> (meaning mvn clean install -Pcore,fake), from the moment you compile a distribution with this parameter and you launch this distribution a directory called <strong>load</strong> will be created in the root of the chameleon distribution ($FUCHSIA/distribution/target/chameleon-distribution), this directory will be used to deploy your files that contain the key-value that you need to be instantiated in the platform.</p>
</div>
<div class="paragraph">
<p>An example of such file is this one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>id=mqtt-dispatch-event-admin
exporter.id=camera-exporter

deviceType=camera
deviceSubType=another

mqtt.queue=public</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you type <strong>declaration</strong> in the console you should see:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>Service properties:
		objectClass = [Ljava.lang.String;@26f6a1
		service.id = 319
Metadata
	id=mqtt-dispatch-event-admin
	deviceType=camera
	deviceSubType=another
	exporter.id=camera-exporter
	mqtt.queue=public</code></pre>
</div>
</div>
<div class="paragraph">
<p>This indicated that the file that you have just deployed have been read and turned into a declaration.</p>
</div>
</div>
<div class="sect3">
<h4 id="_mdns">mDNS</h4>
<div class="paragraph">
<p>mDNS is a discovery protocol based on the previous Bonjour(c), from Apple. To perform a simple test of such protocol, its enough to compile a fuchsia distribution with the following parameters:</p>
</div>
<div class="paragraph">
<p><em>mvn clean install -Pcore,mdns,mdns-config</em></p>
</div>
<div class="paragraph">
<p>core and mdns are the modules that we need, in this case, the fuchsia core types and the discovery module itself. The 3td element <em>mdns-config</em> is the element responsible to configure the discovery. Even though the <strong>mdns</strong> module is available with the -Pmdns profile, it is necessary to create an instance of it, shaping it as we wish. We will explain in few paragraphs how to do that manually, but for now we will use an configuration example that setup the discovery to findout all the printers available in the local network, for that we add the profile -Pmdns-config.</p>
</div>
<div class="paragraph">
<p>To verify that the discovery works properly you can use the console.</p>
</div>
<div class="paragraph">
<p>If you type <strong>declaration</strong> on the console you should see an output similar to this:</p>
</div>
<div class="paragraph">
<p>You should see all your printers in form of:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>Metadata
	id=hp LaserJet 2300 (scribe missions)
	discovery.mdns.device.name=hp LaserJet 2300 (scribe missions)
Metadata
	id=HP LaserJet 600 M602 [2F0B40]
	discovery.mdns.device.name=HP LaserJet 600 M602 [2F0B40]
	Service properties:
		objectClass = [Ljava.lang.String;@fcc720
		service.id = 312
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>And if you type <strong>discovery</strong> in the console you should see:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>Discovery [DNSSDDiscovery] provided by bundle mdns (19)
	Service properties:
		dnssd.service.type = _printer._tcp.local.
		factory.name = DNSSDDiscoveryFactory
		instance.name = DNSSDDiscovery
		objectClass = [Ljava.lang.String;@1db4108
		service.id = 301</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this approach we used a configuration that was available in Fuchsia. But that is not usually the case; most of the time we are required to instantiate the discovery ourselves configure the filter in a way that is the application need it.</p>
</div>
<div class="paragraph">
<p>The following configuration that makes available to import all the printers on the local network inside the platform with requiring any other information than the type of the device that interest us.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="java language-java">@Configuration
public class DNSSDInitializer {
    Instance dnssdDiscovery = instance()
            .of("DNSSDDiscoveryFactory")
            .named("DNSSDDiscovery")
            .with("dnssd.service.type").setto("_printer._tcp.local.");

}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<img src="./images/icons/tip.png" alt="Tip">
</td>
<td class="content">
<div class="paragraph">
<p>This instance can be created in any fashion, as long as it is an <a href="http://www.ipojo.org">iPOJO</a> instance.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_fake_importer_2">Fake-Importer</h3>
<div class="paragraph">
<p>To start, we are going to use <em>fake-importer</em>, which create an instance of a GenericDevice interface based on a description that will be added into a file. This file must to be published in a specific folder of the framework (<em>load</em> folder by default).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>mvn clean install -Pcore,fake</code></pre>
</div>
</div>
<div class="paragraph">
<p>After launching the platform and type <strong>instances</strong> you will see something like</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>...
Instance org.ow2.chameleon.fuchsia.tools.shell.FuchsiaGogoCommand-0 -&gt; valid
Instance Fuchsia-FakeDiscovery -&gt; valid
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you type <strong>declaration</strong> you will see that there are no declarations available.</p>
</div>
<div class="paragraph">
<p>Now lets create a text file with the following content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>id=virtual-camera
deviceType=camera
deviceSubType=sony-dhc
device.serialNumber=virtual-camera</code></pre>
</div>
</div>
<div class="paragraph">
<p>Copy this file for to the folder <em>load</em> (located inside chameleon directory), after that you can type the command <em>declaration</em> and you should see:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>Service properties:
		objectClass = [Ljava.lang.String;@19d8f01
		service.id = 316
Metadata
	id=virtual-camera
	deviceType=camera
	deviceSubType=sony-dhc
	device.serialNumber=virtual-camera</code></pre>
</div>
</div>
<div class="paragraph">
<p>A declaration with the exactly the same properties values as the file that you just deployed.</p>
</div>
<div class="paragraph">
<p>If  you install the fuchsia bundle <strong>Fake-Importer</strong>, you can type <strong>instances</strong>, and you should see:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>...
Instance GenericDeviceInst-virtual-camera -&gt; valid</code></pre>
</div>
</div>
<div class="paragraph">
<p>As we can see, the fake importer created an instance name <strong>GenericDeviceInst-virtual-camera</strong> (our <strong>id</strong> preceed by <em>GenericDeviceInst-</em>)</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2013-12-10 09:09:58 CET
</div>
</div>
</body>
</html>